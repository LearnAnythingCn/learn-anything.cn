{
    "componentChunkName": "component---src-templates-article-article-detail-gen-js",
    "path": "/gatsby-routes",
    "result": {"data":{"strapiArticles":{"id":"Articles_349","title":"Gatsby的路由机制详解！","description":"路由是指 域名(URL) 与 代码页面文件 之间的对应关系，浏览器通过 url 来访问代码页面实际展示效果。","content":"##### 一、路由是什么？\n\n浏览器输入一个 URL 后，网站选择哪个 代码文件 来处理这个 URL 页面呢？这个 URL 与 代码文件  的对应关系称之为路由。下面看看 Gatsby 中几种路由方式。\n\n---\n\n##### 二、自定义路由\n\n###### 1、src/pages\n\nsrc/pages 目录下 js文件，都会被创建URL来访问。注意 index.js文件比较特殊(URL 默认访问 index.js)，体会下面路径与URL的对应关系。\n\n| 路径                    | URL                    |\n| -------------------- | -------------------- |\n| src/pages/index.js | yoursite.com |\n| src/pages/information/index.js | yoursite.com/information |\n| src/pages/contact.js | yoursite.com/contact |\n| src/pages/information/contact.js | yoursite.com/information/contact |\n\n---\n\n##### 三、数据层节点路由\n\nhttp://localhost:8000/___graphql  这里能看到的节点，都可以转成用 URL 访问的页面。原理：节点名+属性名，来作为页面代码文件的名字，就可以顺利建立URL 到 代码页面的路由。\n\n###### 1、查看节点数据\n\n```shell\n# 查询语句\nquery MyQuery {\n  mdx {\n    id\n    slug\n  }\n}\n\n# 对应查询结果\n{\n  \"data\": {\n    \"mdx\": {\n      \"id\": \"c814e302-9fd7-58d6-99fa-d18f5dc2450c\",\n      \"slug\": \"first-blog\"\n    }\n  },\n  \"extensions\": {}\n}\n```\n\n###### 2、创建代码页面\n\n新建页面  `src/pages/{mdx.slug}.js`  ，编写如下代码：\n\n```js\nimport * as React from 'react'\nimport { graphql } from 'gatsby'\nimport { MDXRenderer } from 'gatsby-plugin-mdx'\n\nconst BlogPost = (props) => {\n  console.log(\"props.params : \", props.params);\n  console.log(\"props.pageContext : \", props.pageContext);\n  return (\n    <MDXRenderer>\n      {props.data.mdx.body}\n    </MDXRenderer>\n  )\n}\n\nexport const query = graphql`\n    query($id: String) {\n      mdx(id: {eq: $id}) {\n        body\n      }\n    }\n  `\n\nexport default BlogPost\n```\n\n###### 3、访问页面\n\n重新启动 gatsby 项目，即可通过链接访问页面：http://localhost:8000/first-blog\n\n---\n\n###### 4、其他路由写法\n\n- `__`  语法\n\n  ```shell\n  # 用 __ 表示下一级属性\n  query MyQuery {\n    mdx {\n      id\n      slug\n      frontmatter {\n        title\n      }\n    }\n  }\n  \n  # 对应代码页面 名称\n  src/pages/{mdx.frontmatter__title}.js\n  ```\n\n- `()`  语法\n\n  ```shell\n  # 用 () 表示多层\n  allMarkdownRemark {\n    nodes {\n      id # Gatsby always queries for id\n      parent {\n        … on File {\n          name\n        }\n      }\n    }\n  }\n  \n  # 对应代码页面 名称\n  src/pages/blog/{MarkdownRemark.parent__(File)__name}.js\n  ```\n\n---\n\n##### 四、`gatsby-node.js` 中 创建页面\n\n###### 1、createPages\n\n在 `gatsby-node.js` 文件中，使用 `createPages` 接口来创建页面。\n\n- 第一步：查询所有需要创建页面的节点\n\n  ```js\n  exports.createPages = async function ({ actions, graphql }) {\n    const { data } = await graphql(`\n      query {\n        allMarkdownRemark {\n          nodes {\n            fields {\n              slug\n            }\n          }\n        }\n      }\n    `)\n    data.allMarkdownRemark.forEach(node => {\n      const slug = node.fields.slug\n      actions.createPage({\n        path: slug,\n        component: require.resolve(`./src/templates/blog-post.js`),\n        context: { slug: slug },\n      })\n    })\n  }\n  ```\n\n- 第二步：上面查询到的每一个节点，都会调用 `./src/templates/blog-post.js` 来产生具体页面，注意这里使用到了页面参数：props.pageContext，其包含的数据对应 ：context: { slug: slug }。\n\n  ```js\n  import * as React from 'react'\n  import { graphql } from 'gatsby'\n  \n  const BlogPost = (props) => {\n  \n    console.log(\"props.params : \", props.params);\n    console.log(\"props.pageContext : \", props.pageContext);\n  \n    return (\n      <div>{props.data.markdownRemark.html}</div>\n    )\n  }\n  \n  export const query = graphql`\n      query($id: String) {\n        markdownRemark(slug: {eq: $slug}) {\n          nodes {\n            html\n          }\n        }\n      }\n    `\n  \n  export default BlogPost\n  ```\n\n- 第三步：访问\n\n  重启 gatsby，浏览器访问：http://localhost:8000/slug，替换这里的slug为节点实际值。\n\n---\n\n##### 五、参考文档\n\n- [creating-routes - 官方文档](https://www.gatsbyjs.com/docs/how-to/routing/creating-routes/)\n- [route-api -  官方demo](https://github.com/gatsbyjs/gatsby/tree/master/examples/route-api)\n\n","url":"https://learn-anything.cn/gatsby-routes","published_at":"2021-11-09T06:29:25.000Z","tags":[{"name":"Gatsby","slug":"gatsby"}]},"site":{"siteMetadata":{"title":"收集优质资源","author":"@learn-anything.cn","description":"追求极简语言，说明事物因果！","email":"lh@learn-anything.cn"}}},"pageContext":{"title":"Gatsby的路由机制详解！","slug":"gatsby-routes"}},
    "staticQueryHashes": ["63159454"]}