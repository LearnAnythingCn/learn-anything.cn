{
    "componentChunkName": "component---src-templates-article-article-detail-gen-js",
    "path": "/gatsby-cache",
    "result": {"data":{"strapiArticles":{"id":"Articles_426","title":"Nginx中配置Gatsby项目的缓存功能？","description":"Gatsby 项目生成的静态网站，可使用 HTTP缓存功能 ，不仅可以减少网络流量，还可以减轻服务器压力 和 提升网站的访问速度。","content":"##### 一、简介\n\nGatsby 项目生成的静态网站，可使用 HTTP缓存功能 ，不仅可以减少网络流量，还可以减轻服务器压力 和 提升网站的访问速度。\n\n---\n\n##### 二、文件缓存说明\n\nGatsby 项目编译生成的文件都在public 文件夹中，其文件在部署时分为两类：一类是需要经常更新；另一类不需要。\n\n###### 1、每次访问都要验证\n\n对于经常更新的文件，可以在每次访问时，发个请求给服务器验证缓存有没有新版本，有新版本服务器就返回新版本数据，没有新版本服务器就只需回复一个指令而无需发送整个文件，客户端直接用缓存显示即可。\n\n下面几种数据的缓存头，应该这样设置：`cache-control: public, max-age=0, must-revalidate` 。\n\n- HTML\n\n  HTML 文件更新频率比较高，应该每次访问都发送验证请求，检测是否有新版本，有就下载使用新版本。\n\n- 页面数据\n\n  `public/page-data`  目录下的  `page-data.json`  文件，给 HTML 文件提供数据的文件，也会时常更新。\n\n- 应用程序数据\n\n  `app-data.json`  包含网站版本等信息，可以确保浏览器显示版本与服务器部署版本的一致性。\n\n- `sw.js`\n\n  此 js 文件是由  `gatsby-plugin-offline`  和其他插件生成，用于实现网站离线访问的功能，也需要每次加载时检测是否有新版本。\n\n---\n\n###### 2、应该被永久缓存\n\n对于不会改变的资源，可以设置一个较长的缓存有效期，下面几种文件的缓存头，应该这样设置  ：`cache-control: public, max-age=31536000, immutable` 。\n\n- JavaScript 和 CSS\n\n  Gatsby 在编译发布时，会根据 js 和 css 的内容，使用哈希算法生成其文件名，只要内容改变，其文件名必然会改变，所以不用担心相同文件名不同版本的问题，可以安全永久缓存。\n\n- 静态文件\n\n  `static/`  文件夹下的文件，其名称也是根据其内容，使用hash算法生成的，只要文件内容改变，名称也必然会改变，所以也不用担心版本问题，可以安全永久缓存。\n\n---\n\n##### 三、缓存头的说明\n\n可以用  `no-cache`  代替 `max-age=0, must-revalidate`  ，功能相同。[cache-control 的详细说明，看这里！](https://learn-anything.cn/http-cache-control)\n\n---\n\n##### 四、Nginx 中怎么设置？\n\n用 Nginx 部署 Gatsby 项目时，缓存功能应该这样设置：\n\n```\nlocation ^~ /static/ {\n\tadd_header Cache-Control \"public, max-age=31536000, immutable\";\n}\n\nlocation ~* \\.(css|js)$ {\n\tadd_header Cache-Control \"public, max-age=31536000, immutable\";\n}\n\nlocation ~* \\.(json|html)$ {\n\tadd_header Cache-Control \"public, no-cache\";\n}\n```\n\n---\n\n##### 五、参考文档\n\n- [caching  -  Gatsby  -  官方文档](https://www.gatsbyjs.com/docs/caching/)","url":"https://learn-anything.cn/gatsby-cache","published_at":"2021-12-02T05:57:59.000Z","tags":[{"name":"Gatsby","slug":"gatsby"},{"name":"性能优化","slug":"performance-optimization"},{"name":"Nginx","slug":"nginx"}]},"site":{"siteMetadata":{"title":"收集优质资源","author":"@learn-anything.cn","description":"追求极简语言，说明事物因果！","email":"lh@learn-anything.cn"}}},"pageContext":{"title":"Nginx中配置Gatsby项目的缓存功能？","slug":"gatsby-cache"}},
    "staticQueryHashes": ["63159454"]}